## 什么是索引？

索引是数据管理系统中用于排序的数据结构，以协助快速查询。

## 索引对比

### B树索引

原理：将索引数据分成多个节点，每个节点包含多个键和指针，可以保证每个节点的高度大致相等，从而实现高效的索引查询

优点：支持范围查询可以快速定位某个范围内的数据，支持动态数据插入和删除

缺点：需要占用较多的磁盘空间

### Hash索引

原理：将每个索引数据的键值通过哈希函数映射为一个地址，然后将索引数据存储在对应地址的桶中，查询时通过计算哈希值来直接定位到对应的索引数据

优点：查询效率高，可以通过哈希值直接定位数据

缺点：不支持范围查询，哈希表大小有限，在冲突情况下需要额外处理

### 聚簇索引

原理：将表按照索引键值的顺序进行排序，并将数据存储在对应的数据页中

优点：支持范围查询和排序，可以通过一次I/O操作获取更多数据。

缺点：插入数据需要重新排序，效率较低，如果主键是随机值也会导致效率低，且维护代价较高

## 关系代数

![image-20230406102324744](C:\Users\caryz\AppData\Roaming\Typora\typora-user-images\image-20230406102324744.png)

## SQL

1. ```sql
   create table course_count
   (
       cc_sid   varchar(20) not null
           primary key,
       cc_sname varchar(20) not null,
       cc_count int         null
   );
   ```

   ```sql
   insert into course_count
   select s_id, s_name, count(sc_cid)
   from student left join stu_course sc on student.s_id = sc.sc_sid
   group by s_id
   ```

2. ```sql
   select s_name
   from student
   where s_name like '诸%' and s_name not like '诸葛%'
   ```

3. ```sql
   select s_id, s_name from student
   where s_id in (
       select sc_sid from stu_course
       where sc_score in (
           select max(sc_score)
           from stu_course
           group by sc_cid
       )
   )
   ```

4. ```sql
   select sc_sid, sc_cid, min(sc_time)
   from stu_course
   group by sc_sid, sc_cid
   ```

5. ```sql
   update stu_course scr
   set scr.sc_score=60
   where (scr.sc_sid, scr.sc_cid, scr.sc_time) not in (
       select sc.sc_sid, sc.sc_cid, min(sc.sc_time)
       from (select * from stu_course) sc
       group by sc.sc_sid, sc.sc_cid
   )
   ```

6. ```sql
   select s_id, c_id
   from student cross join course
   where (s_id, c_pre) in (
       select sc_sid, sc_cid
       from stu_course
   ) and (s_id, c_id) not in (
       select sc_sid, sc_cid
       from stu_course
   )
   order by s_id, c_id
   ```

   

